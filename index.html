<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Scheme-Physics</title>
	<link href="style.css" rel="stylesheet" type="text/css" />
</head>
<body>
	<div class = "world">
		<p class = "labels">World</p>
		<canvas id = "canvas" width = 500 height = 500 tabindex="1"></canvas>
	</div>
	<div class = "in">
		<p class = "labels">Code</p>
		<textarea id = "input" spellcheck = "false"></textarea>
		<div style = "text-align : center">
			<input type = "button" id = "eval_btn" class = "button" value = "Evaluate"></input><br />
			<input type = "button" id = "sample_btn" class = "button" value = "Sample Code"></input>
		</div>
	</div>
	<div class = "out">
		<p class = "labels">Logs</p>
		<textarea id = "output" disabled = "disabled" spellcheck = "false"></textarea>
		<div style = "text-align : center">
			<input type = "button" id = "clear_btn" class = "button" value = "Clear"></input>
		</div>
	</div>
	<script type="text/javascript" src="dep/webgl-utils.js"></script>
	<script type="text/javascript" src="dep/Box2dWeb-2.1.a.3.js"></script>
	<script type="text/javascript" src="dep/biwascheme.js" ></script>
	<script type="text/javascript" src="dep/jquery.js"></script>
	<script type="text/javascript">
		var canvas_width = 500;
		var canvas_height = 500;
	</script>
	<script type="text/javascript" src="render.js"></script>
	<script type="text/javascript" src="scheme.js"></script>
	<!-- vertex shader -->
	<script id="2d-vertex-shader" type="x-shader/x-vertex">
		attribute vec2 a_position;

		uniform vec2 u_resolution;
		uniform vec2 u_translation;
		uniform vec2 u_rotation;
		void main() {
			vec2 rotatedPosition = vec2(
			a_position.x * u_rotation.y + a_position.y * u_rotation.x,
			a_position.y * u_rotation.y - a_position.x * u_rotation.x);

			// Add in the translation.
			vec2 position = rotatedPosition + u_translation;

			// convert the position from pixels to 0.0 to 1.0
			vec2 zeroToOne = position / u_resolution;

			// convert from 0->1 to 0->2
			vec2 zeroToTwo = zeroToOne * 2.0;

			// convert from 0->2 to -1->+1 (clipspace)
			vec2 clipSpace = zeroToTwo - 1.0;

			gl_Position = vec4(clipSpace, 0, 1);
		}
	</script>
	<!-- fragment shader -->
	<script id="2d-fragment-shader" type="x-shader/x-fragment">
		precision mediump float;

		uniform vec4 u_color;

		void main() {
			gl_FragColor = u_color;
		}
	</script>
	<!-- Scheme code that is precompiled-->
	<script id = "basic_functions" type = "text/scheme">
		(define dynamic "dynamic")
		(define static "static")
		(define (rect-shape width height)
			(list width height))
		(define (circle-shape radius)
			(list radius))
		(define (polygon-shape . vertices)
			vertices)
		(define (attributes density friction restitution)
			(list density friction restitution))
		(define (color r g b)
			(list r g b))
		(define (vector2 x y)
			(list x y))
		
		;;Events
		(define mouseup "mouseup")
		(define mousedown "mousedown")
		(define mousemove "mousemove")
		(define keyup "keyup")
		(define keydown "keydown")
	</script>
	
	<!-- Sample code (do not tab)-->
	<script id = "sample" type = "text/scheme">
;;add-body adds a body to the world
;;Parameters : type, shape, position, angle, attributes, color, id, velocity
;;rect-shape width height
;;circle-shape radius
;;polygon-shape (vector2 x1 y1) (vector2 x2 y2) ...
;;attributes density friction restitution
;;vector2 x y
;;color red green blue
;;Every body needs an id with which you may refer to it
;;An optional initial velocity may be specified

;;Look at features file

;;generates an id
(define (gen-id)
  (string-concat (list "id" (+ body-count 1))))

(define b-shape (rect-shape 50.0 40.0))
(define b-attribs (attributes 1.0 0.5 0.3))
(define b-position (vector2 50.0 400.0))
(define b-color (color 0.3 0.4 0.65))
(define b-angle 0.15)
(define vel (vector2 -15.0 -10.0))

(add-body dynamic b-shape b-position b-angle b-attribs b-color (gen-id) vel)

(set! b-shape (circle-shape 30.0))
(set! b-attribs (attributes 0.5 0.5 1.0))
(set! b-position (vector2 400.0 200.0))
(set! b-color (color 1.0 0.1 0.3))
(set! b-angle 0.4)

(add-body dynamic b-shape b-position b-angle b-attribs b-color (gen-id))

(set! b-shape (polygon-shape (vector2 30.0 40.0) (vector2 10.0 -30.0) (vector2 60.0 0.0) (vector2 80.0 60.0) (vector2 70.0 80.0)))
(set! b-attribs (attributes 1.0 0.5 0.5))
(set! b-position (vector2 100.0 320.0))
(set! b-color (color 0.67 1.0 0.18))
(set! b-angle 0.2)

(add-body dynamic b-shape b-position b-angle b-attribs b-color (gen-id))
	</script>

</body>
</html>
